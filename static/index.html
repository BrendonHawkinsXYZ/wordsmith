<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Smith - LLM Prompt Testing Tool</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        :root {
            --primary-color: #6366F1;
            --secondary-color: #F3F4F6;
            --border-color: #E5E7EB;
            --text-color: #111827;
            --text-secondary: #6B7280;
            --white: #FFFFFF;
            --success: #10B981;
            --danger: #EF4444;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        body {
            background-color: #F9FAFB;
            color: var(--text-color);
            padding: 0;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header styles */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--white);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1.25rem;
        }
        
        .logo-icon {
            color: var(--primary-color);
            display: inline-flex;
            align-items: center;
            transform: rotate(-45deg);
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        /* Main container styles */
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 2rem;
            flex-grow: 1;
        }
        
        /* Global input section */
        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-color);
        }
        
        .input-container {
            margin-bottom: 2rem;
        }
        
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--white);
            font-size: 0.9rem;
            resize: vertical;
            color: var(--text-color);
            transition: border-color 0.2s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        
        /* Prompt columns layout */
        .prompt-columns {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .prompt-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        /* Settings row */
        .settings-row {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .model-select {
            flex: 1;
        }
        
        .temp-control, .topp-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .control-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        /* Selects and inputs */
        select, input[type="number"] {
            padding: 0.4rem 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--white);
            font-size: 0.9rem;
            color: var(--text-color);
        }
        
        select {
            cursor: pointer;
            padding-right: 2rem;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236B7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1rem;
        }
        
        input[type="number"] {
            width: 4rem;
            text-align: center;
        }
        
        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        /* Output area */
        .output-area {
            width: 100%;
            min-height: 240px;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--white);
            font-size: 0.9rem;
            color: var(--text-color);
            overflow-y: auto;
            line-height: 1.5;
        }
        
        /* Button styles */
        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background-color: #5253CC;
        }
        
        .btn-secondary {
            background-color: var(--white);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-icon {
            margin-right: 0.25rem;
        }
        
        /* Comparison styles */
        .diff {
            color: var(--danger);
            background-color: rgba(239, 68, 68, 0.1);
        }
        
        .same {
            color: var(--text-color);
        }
        
        /* Loading indicator */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .spinner {
            width: 2.5rem;
            height: 2.5rem;
            border: 3px solid var(--secondary-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            .prompt-columns {
                flex-direction: column;
            }
            
            .settings-row {
                flex-wrap: wrap;
            }
            
            .model-select {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            
            header {
                padding: 0.75rem 1rem;
            }
            
            .container {
                padding: 1rem;
            }
        }
    </style>
    <!-- Include jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch.js"></script>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </div>
            <span>Word Smith</span>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" id="help-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                Help
            </button>
            <button class="btn btn-primary" id="save-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                Save
            </button>
        </div>
    </header>
    
    <div class="container">
        <!-- Global Input Section -->
        <div class="input-container">
            <h2 class="section-title">Global Input</h2>
            <textarea id="global-input" placeholder="Enter your base text here..."></textarea>
        </div>
        
        <!-- Prompt Columns -->
        <div class="prompt-columns">
            <!-- Prompt 1 Column -->
            <div class="prompt-column">
                <h2 class="section-title">Prompt 1</h2>
                
                <div class="settings-row">
                    <div class="model-select">
                        <select id="model1">
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="claude">Claude</option>
                        </select>
                    </div>
                    
                    <div class="temp-control">
                        <span class="control-label">Temp:</span>
                        <input type="number" id="temp1" min="0" max="1" step="0.1" value="0.7">
                    </div>
                    
                    <div class="topp-control">
                        <span class="control-label">Top P:</span>
                        <input type="number" id="topp1" min="0" max="1" step="0.1" value="1.0">
                    </div>
                </div>
                
                <textarea id="prompt1" placeholder="Enter prompt 1..."></textarea>
                
                <div id="output1" class="output-area"></div>
            </div>
            
            <!-- Prompt 2 Column -->
            <div class="prompt-column">
                <h2 class="section-title">Prompt 2</h2>
                
                <div class="settings-row">
                    <div class="model-select">
                        <select id="model2">
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="claude">Claude</option>
                        </select>
                    </div>
                    
                    <div class="temp-control">
                        <span class="control-label">Temp:</span>
                        <input type="number" id="temp2" min="0" max="1" step="0.1" value="0.7">
                    </div>
                    
                    <div class="topp-control">
                        <span class="control-label">Top P:</span>
                        <input type="number" id="topp2" min="0" max="1" step="0.1" value="1.0">
                    </div>
                </div>
                
                <textarea id="prompt2" placeholder="Enter prompt 2..."></textarea>
                
                <div id="output2" class="output-area"></div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="buttons-container">
            <button id="submit-btn" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                Run Comparison
            </button>
            <button id="clear-btn" class="btn btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Clear All
            </button>
        </div>
    </div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <script>
        // Wait for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Get references to DOM elements
            const globalInputEl = document.getElementById('global-input');
            const prompt1El = document.getElementById('prompt1');
            const prompt2El = document.getElementById('prompt2');
            const output1El = document.getElementById('output1');
            const output2El = document.getElementById('output2');
            const submitBtn = document.getElementById('submit-btn');
            const clearBtn = document.getElementById('clear-btn');
            const saveBtn = document.getElementById('save-btn');
            const helpBtn = document.getElementById('help-btn');
            const loadingEl = document.getElementById('loading');
            
            // Settings elements
            const model1El = document.getElementById('model1');
            const temp1El = document.getElementById('temp1');
            const topp1El = document.getElementById('topp1');
            
            const model2El = document.getElementById('model2');
            const temp2El = document.getElementById('temp2');
            const topp2El = document.getElementById('topp2');
            
            // Function to highlight differences between two texts
            function highlightDifferences(text1, text2) {
                const dmp = new diff_match_patch();
                const diffs = dmp.diff_main(text1, text2);
                dmp.diff_cleanupSemantic(diffs);
                
                const output1Html = [];
                const output2Html = [];
                
                for (let i = 0; i < diffs.length; i++) {
                    const [operation, text] = [diffs[i][0], diffs[i][1]];
                    const textSpan = text.replace(/\n/g, '<br>');
                    
                    if (operation === 0) { // Equal
                        output1Html.push(`<span class="same">${textSpan}</span>`);
                        output2Html.push(`<span class="same">${textSpan}</span>`);
                    } else if (operation === -1) { // Deletion (in text1 but not in text2)
                        output1Html.push(`<span class="diff">${textSpan}</span>`);
                    } else if (operation === 1) { // Insertion (in text2 but not in text1)
                        output2Html.push(`<span class="diff">${textSpan}</span>`);
                    }
                }
                
                return {
                    output1: output1Html.join(''),
                    output2: output2Html.join('')
                };
            }
            
            // Submit button event listener
            submitBtn.addEventListener('click', async function() {
                // Show loading spinner
                loadingEl.style.display = 'flex';
                
                try {
                    // Get values from input fields
                    const globalInput = globalInputEl.value;
                    const prompt1 = prompt1El.value;
                    const prompt2 = prompt2El.value;
                    
                    // Get settings values
                    const settings1 = {
                        model: model1El.value,
                        temperature: parseFloat(temp1El.value),
                        top_p: parseFloat(topp1El.value),
                        max_tokens: 1000 // Default value
                    };
                    
                    const settings2 = {
                        model: model2El.value,
                        temperature: parseFloat(temp2El.value),
                        top_p: parseFloat(topp2El.value),
                        max_tokens: 1000 // Default value
                    };
                    
                    // Validate inputs
                    if (!prompt1 || !prompt2) {
                        alert('Please enter both prompts before submitting.');
                        loadingEl.style.display = 'none';
                        return;
                    }
                    
                    // Make API request
                    const response = await fetch('/api/process', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            global_input: globalInput,
                            prompt1,
                            prompt2,
                            settings1,
                            settings2
                        })
                    });
                    
                    // Check if request was successful
                    if (!response.ok) {
                        throw new Error('API request failed');
                    }
                    
                    // Get response data
                    const data = await response.json();
                    
                    // Compare and highlight differences directly in outputs
                    const highlightedOutputs = highlightDifferences(data.output1, data.output2);
                    
                    // Update output fields with highlighted differences
                    output1El.innerHTML = highlightedOutputs.output1;
                    output2El.innerHTML = highlightedOutputs.output2;
                    
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred: ' + error.message);
                } finally {
                    // Hide loading spinner
                    loadingEl.style.display = 'none';
                }
            });
            
            // Clear button event listener
            clearBtn.addEventListener('click', function() {
                globalInputEl.value = '';
                prompt1El.value = '';
                prompt2El.value = '';
                output1El.innerHTML = '';
                output2El.innerHTML = '';
                
                // Reset to default values
                temp1El.value = 0.7;
                topp1El.value = 1.0;
                model1El.value = 'gpt-4o';
                
                temp2El.value = 0.7;
                topp2El.value = 1.0;
                model2El.value = 'gpt-4o';
            });
            
            // Help button event listener
            helpBtn.addEventListener('click', function() {
                alert('Word Smith Help\n\n1. Enter your global input text that will be used with both prompts.\n2. Configure model settings for each prompt.\n3. Enter your two different prompts.\n4. Click "Run Comparison" to see the outputs.\n5. Differences between outputs will be highlighted in red.\n6. Use "Save" to export the results as a PDF.');
            });
            
            // Save button event listener
            saveBtn.addEventListener('click', function() {
                // Make sure we have outputs to save
                if (!output1El.innerHTML && !output2El.innerHTML) {
                    alert('Please run a comparison to generate outputs before saving.');
                    return;
                }
                
                // Initialize jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'pt', 'letter');
                
                // Set up document properties
                doc.setFontSize(18);
                doc.text('Word Smith - Prompt Testing Results', 72, 40);
                
                // Add global input
                let yPos = 80;
                doc.setFontSize(14);
                doc.text('GLOBAL INPUT:', 72, yPos);
                doc.setFontSize(10);
                const globalInputLines = doc.splitTextToSize(globalInputEl.value, 450);
                doc.text(globalInputLines, 72, yPos + 20);
                
                // Add settings for both prompts
                yPos = yPos + 20 + (globalInputLines.length * 12);
                doc.setFontSize(14);
                doc.text('PROMPT 1 SETTINGS:', 72, yPos);
                doc.setFontSize(10);
                yPos += 20;
                doc.text(`Model: ${model1El.options[model1El.selectedIndex].text}`, 72, yPos);
                yPos += 15;
                doc.text(`Temperature: ${temp1El.value}`, 72, yPos);
                yPos += 15;
                doc.text(`Top-p: ${topp1El.value}`, 72, yPos);
                
                yPos += 30;
                doc.setFontSize(14);
                doc.text('PROMPT 2 SETTINGS:', 72, yPos);
                doc.setFontSize(10);
                yPos += 20;
                doc.text(`Model: ${model2El.options[model2El.selectedIndex].text}`, 72, yPos);
                yPos += 15;
                doc.text(`Temperature: ${temp2El.value}`, 72, yPos);
                yPos += 15;
                doc.text(`Top-p: ${topp2El.value}`, 72, yPos);
                
                // Add prompts
                yPos += 30;
                doc.setFontSize(14);
                doc.text('PROMPT 1:', 72, yPos);
                doc.setFontSize(10);
                const prompt1Lines = doc.splitTextToSize(prompt1El.value, 450);
                doc.text(prompt1Lines, 72, yPos + 20);
                
                yPos = yPos + 20 + (prompt1Lines.length * 12);
                if (yPos > 700) {
                    doc.addPage();
                    yPos = 40;
                }
                
                doc.setFontSize(14);
                doc.text('PROMPT 2:', 72, yPos);
                doc.setFontSize(10);
                const prompt2Lines = doc.splitTextToSize(prompt2El.value, 450);
                doc.text(prompt2Lines, 72, yPos + 20);
                
                // Check if we need to add a new page
                yPos = yPos + 20 + (prompt2Lines.length * 12);
                if (yPos > 700) {
                    doc.addPage();
                    yPos = 40;
                }
                
                // Add outputs
                doc.setFontSize(14);
                doc.text('OUTPUT 1:', 72, yPos);
                doc.setFontSize(10);
                // Get text content without HTML tags
                const output1Text = output1El.innerText || output1El.textContent;
                const output1Lines = doc.splitTextToSize(output1Text, 450);
                doc.text(output1Lines, 72, yPos + 20);
                
                yPos = yPos + 20 + (output1Lines.length * 12);
                if (yPos > 700) {
                    doc.addPage();
                    yPos = 40;
                }
                
                doc.setFontSize(14);
                doc.text('OUTPUT 2:', 72, yPos);
                doc.setFontSize(10);
                const output2Text = output2El.innerText || output2El.textContent;
                const output2Lines = doc.splitTextToSize(output2Text, 450);
                doc.text(output2Lines, 72, yPos + 20);
                
                // Add a note about comparison
                yPos = yPos + 20 + (output2Lines.length * 12);
                if (yPos > 700) {
                    doc.addPage();
                    yPos = 40;
                }
                
                doc.setFontSize(14);
                doc.text('COMPARISON NOTE:', 72, yPos);
                doc.setFontSize(10);
                doc.text('Differences between outputs are highlighted in red in the application.', 72, yPos + 20);
                
                // Save the PDF
                doc.save('word-smith-results.pdf');
            });
        });
    </script>
</body>
</html>
